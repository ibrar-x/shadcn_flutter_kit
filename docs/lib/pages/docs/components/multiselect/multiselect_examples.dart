import 'package:flutter/widgets.dart';
import '../../component_example_models.dart';
import 'multiselect_example_1.dart';
import 'multiselect_example_2.dart';
import 'multiselect_example_3.dart';

const ComponentExample multiselectExample1 = ComponentExample(
  title: "Example",
  builder: _buildMultiselectExample1,
  code: "import 'package:docs/shadcn_ui.dart';\n\nclass MultiSelectExample1 extends StatefulWidget {\n  const MultiSelectExample1({super.key});\n\n  @override\n  State<MultiSelectExample1> createState() => _MultiSelectExample1State();\n}\n\nclass _MultiSelectExample1State extends State<MultiSelectExample1> {\n  Iterable<String>? selectedValues;\n  @override\n  Widget build(BuildContext context) {\n    // Basic multi-select with a popup list and chips as selected items.\n    // onChanged returns the new iterable of selected values.\n    return MultiSelect<String>(\n      itemBuilder: (context, item) {\n        // Render each selected value as a chip.\n        return MultiSelectChip(value: item, child: Text(item));\n      },\n      popup: const SelectPopup(\n          items: SelectItemList(children: [\n        SelectItemButton(\n          value: 'Apple',\n          child: Text('Apple'),\n        ),\n        SelectItemButton(\n          value: 'Banana',\n          child: Text('Banana'),\n        ),\n        SelectItemButton(\n          value: 'Cherry',\n          child: Text('Cherry'),\n        ),\n      ])),\n      onChanged: (value) {\n        setState(() {\n          selectedValues = value;\n        });\n      },\n      constraints: const BoxConstraints(\n        minWidth: 200,\n      ),\n      value: selectedValues,\n      placeholder: const Text('Select a fruit'),\n    );\n  }\n}\n",
);

Widget _buildMultiselectExample1(BuildContext context) {
  return const MultiSelectExample1();
}

const ComponentExample multiselectExample2 = ComponentExample(
  title: "Example with search",
  builder: _buildMultiselectExample2,
  code: "import 'package:docs/shadcn_ui.dart';\n\nclass MultiSelectExample2 extends StatefulWidget {\n  const MultiSelectExample2({super.key});\n\n  @override\n  State<MultiSelectExample2> createState() => _MultiSelectExample2State();\n}\n\nclass _MultiSelectExample2State extends State<MultiSelectExample2> {\n  final Map<String, List<String>> fruits = {\n    'Apple': ['Red Apple', 'Green Apple'],\n    'Banana': ['Yellow Banana', 'Brown Banana'],\n    'Lemon': ['Yellow Lemon', 'Green Lemon'],\n    'Tomato': ['Red', 'Green', 'Yellow', 'Brown'],\n  };\n  Iterable<String>? selectedValues;\n\n  Iterable<MapEntry<String, List<String>>> _filteredFruits(\n      String searchQuery) sync* {\n    for (final entry in fruits.entries) {\n      final filteredValues = entry.value\n          .where((value) => _filterName(value, searchQuery))\n          .toList();\n      if (filteredValues.isNotEmpty) {\n        yield MapEntry(entry.key, filteredValues);\n      } else if (_filterName(entry.key, searchQuery)) {\n        yield entry;\n      }\n    }\n  }\n\n  bool _filterName(String name, String searchQuery) {\n    return name.toLowerCase().contains(searchQuery);\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    // Multi-select with grouped options and a search field.\n    // The popup is built dynamically and groups items under a label.\n    return MultiSelect<String>(\n      itemBuilder: (context, item) {\n        return MultiSelectChip(value: item, child: Text(item));\n      },\n      popup: SelectPopup.builder(\n        searchPlaceholder: const Text('Search fruit'),\n        builder: (context, searchQuery) {\n          final filteredFruits = searchQuery == null\n              ? fruits.entries\n              : _filteredFruits(searchQuery);\n          return SelectItemList(\n            children: [\n              for (final entry in filteredFruits)\n                SelectGroup(\n                  headers: [\n                    SelectLabel(\n                      child: Text(entry.key),\n                    ),\n                  ],\n                  children: [\n                    for (final value in entry.value)\n                      SelectItemButton(\n                        value: value,\n                        child: Text(value),\n                      ),\n                  ],\n                ),\n            ],\n          );\n        },\n      ),\n      onChanged: (value) {\n        setState(() {\n          selectedValues = value;\n        });\n      },\n      constraints: const BoxConstraints(\n        minWidth: 200,\n      ),\n      value: selectedValues,\n      placeholder: const Text('Select a fruit'),\n    );\n  }\n}\n",
);

Widget _buildMultiselectExample2(BuildContext context) {
  return const MultiSelectExample2();
}

const ComponentExample multiselectExample3 = ComponentExample(
  title: "Asynchronous infinite example",
  builder: _buildMultiselectExample3,
  code: "import 'dart:math';\n\nimport 'package:docs/shadcn_ui.dart';\n\nclass MultiSelectExample3 extends StatefulWidget {\n  const MultiSelectExample3({super.key});\n\n  @override\n  State<MultiSelectExample3> createState() => _MultiSelectExample3State();\n}\n\nclass _MultiSelectExample3State extends State<MultiSelectExample3> {\n  final Map<String, List<String>> fruits = {\n    'Apple': ['Red Apple', 'Green Apple'],\n    'Banana': ['Yellow Banana', 'Brown Banana'],\n    'Lemon': ['Yellow Lemon', 'Green Lemon'],\n    'Tomato': ['Red', 'Green', 'Yellow', 'Brown'],\n  };\n  Iterable<String>? selectedValues;\n\n  Iterable<MapEntry<String, List<String>>> _filteredFruits(\n      String searchQuery) sync* {\n    for (final entry in fruits.entries) {\n      final filteredValues = entry.value\n          .where((value) => _filterName(value, searchQuery))\n          .toList();\n      if (filteredValues.isNotEmpty) {\n        yield MapEntry(entry.key, filteredValues);\n      } else if (_filterName(entry.key, searchQuery)) {\n        yield entry;\n      }\n    }\n  }\n\n  bool _filterName(String name, String searchQuery) {\n    return name.toLowerCase().contains(searchQuery);\n  }\n\n  Color _getColorByChip(String text) {\n    Random random = Random(text.hashCode);\n    double hue = random.nextDouble() * 360;\n    return HSLColor.fromAHSL(1, hue, 0.5, 0.5).toColor();\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    // Advanced multi-select with async loading, empty and loading builders,\n    // and dynamic per-item styling.\n    return MultiSelect<String>(\n      itemBuilder: (context, item) {\n        var color = _getColorByChip(item);\n        return MultiSelectChip(\n          value: item,\n          style: const ButtonStyle.primary().withBackgroundColor(\n            color: color,\n            hoverColor: color.withLuminance(0.3),\n          ),\n          child: Text(item),\n        );\n      },\n      popup: SelectPopup.builder(\n        searchPlaceholder: const Text('Search fruit'),\n        emptyBuilder: (context) {\n          return const Center(\n            child: Text('No fruit found'),\n          );\n        },\n        loadingBuilder: (context) {\n          return const Center(\n            child: CircularProgressIndicator(),\n          );\n        },\n        builder: (context, searchQuery) async {\n          final filteredFruits = searchQuery == null\n              ? fruits.entries.toList()\n              : _filteredFruits(searchQuery).toList();\n          // Simulate an async load to demonstrate loadingBuilder.\n          await Future.delayed(const Duration(milliseconds: 500));\n          return SelectItemBuilder(\n            // Use childCount=0 to switch to emptyBuilder when there are no items.\n            childCount: filteredFruits.isEmpty ? 0 : null,\n            builder: (context, index) {\n              final entry = filteredFruits[index % filteredFruits.length];\n              return SelectGroup(\n                headers: [\n                  SelectLabel(\n                    child: Text(entry.key),\n                  ),\n                ],\n                children: [\n                  for (final value in entry.value)\n                    SelectItemButton(\n                      value: value,\n                      style: const ButtonStyle.ghost().withBackgroundColor(\n                        hoverColor: _getColorByChip(value).withLuminance(0.3),\n                      ),\n                      child: Text(value),\n                    ),\n                ],\n              );\n            },\n          );\n        },\n      ),\n      onChanged: (value) {\n        setState(() {\n          selectedValues = value;\n        });\n      },\n      constraints: const BoxConstraints(\n        minWidth: 200,\n      ),\n      value: selectedValues,\n      placeholder: const Text('Select a fruit'),\n    );\n  }\n}\n",
);

Widget _buildMultiselectExample3(BuildContext context) {
  return const MultiSelectExample3();
}

const List<ComponentExample> multiselectExamples = [
  multiselectExample1,
  multiselectExample2,
  multiselectExample3,
];
